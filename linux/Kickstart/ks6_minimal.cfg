# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
# Use text mode install
text
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
network --onboot yes --device eth1 --bootproto dhcp --noipv6
rootpw  --iscrypted $6$TxonahjV49Q9F5T3$U7Lgk8EWEkNz4LcgLIsWIOTlojL0t5wJDqc0Ud0mk4sLoMNWQ/mllZmP6D3ArDIxjJ4.bu3U35TZhxZgoniXD1
firewall --disable
authconfig --enableshadow --passalgo=sha512
selinux --disable
# Reboot after installation
reboot
timezone Asia/Shanghai
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

clearpart --all --initlabel

zerombr

part /boot --fstype=ext4 --size=512
part pv.008002 --grow --size=200

volgroup vg_centos --pesize=4096 pv.008002
logvol /data --fstype=ext4 --name=lv_data --vgname=vg_centos --size=30720
logvol /home --fstype=ext4 --name=lv_home --vgname=vg_centos --size=5120
logvol /logfile --fstype=ext4 --name=lv_logfile --vgname=vg_centos --size=30720
logvol / --fstype=ext4 --name=lv_root --vgname=vg_centos --size=10240
logvol swap --name=lv_swap --vgname=vg_centos --size=2048
logvol /tmp --fstype=ext4 --name=lv_tmp --vgname=vg_centos --size=5120
logvol /usr --fstype=ext4 --name=lv_usr --vgname=vg_centos --size=15360


%packages --nobase
@core
%post
echo 'export PS1="\e[0;31m\\u\e[m@\\h \\W \\$ "' >> /etc/bashrc
source /etc/bashrc
cd /etc/selinux/ && tar -czf selinux_bak.tar.gz ./*
cd /etc/yum.repos.d/ && tar -czf yum_repo_bak.tar.gz ./* ; rm -f *.repo
cd /etc/sysconfig/network-scripts && tar -czf network.tar.gz ./*
cd /etc/ssh/ && tar -czf ssh_tar.gz ./*
setenforce 0
chkconfig postfix off
chkconfig ip6tables off
chkconfig iptables off 
service ip6tables stop
service iptables stop 
service postfix stop         
sed -i -e 's/#UseDNS yes/UseDNS no/g' -e 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
service sshd restart
cat > /etc/yum.repos.d/CentOS-Base.repo <<EOF
 
[base]
name=CentOS-$releasever - Base - mirrors.aliyun.com
failovermethod=priority
baseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6
 
#released updates 
[updates]
name=CentOS-$releasever - Updates - mirrors.aliyun.com
failovermethod=priority
baseurl=http://mirrors.aliyun.com/centos/$releasever/updates/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6
 
#additional packages that may be useful
[extras]
name=CentOS-$releasever - Extras - mirrors.aliyun.com
failovermethod=priority
baseurl=http://mirrors.aliyun.com/centos/$releasever/extras/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6
 
#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-$releasever - Plus - mirrors.aliyun.com
failovermethod=priority
baseurl=http://mirrors.aliyun.com/centos/$releasever/centosplus/$basearch/
gpgcheck=1
enabled=0
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6
 
#contrib - packages by Centos Users
[contrib]
name=CentOS-$releasever - Contrib - mirrors.aliyun.com
failovermethod=priority
baseurl=http://mirrors.aliyun.com/centos/$releasever/contrib/$basearch/
gpgcheck=1
enabled=0
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6

EOF
yum makecache > /dev/null 2>&1
%end

