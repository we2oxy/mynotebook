# VLAN

1. VLAN指的LAN特指使用路由器分割的网络——也就是广播域。

2. 广播域，指的是广播帧(目标MAC地址全部为1)所能传递到的范围，亦即能够直接通信的范围。

3. ARP请求：建立IP地址和MAC地址的映射关系。

4. RIP：一种路由协议。

5. DHCP：用于自动设定IP地址的协议。

   ## VLAN的作用

   如果整个网络只有一个广播域，那么一旦发出广播信息，就会传遍整个网络，并且对网络中的主机带来额外的负担。因此，在设计LAN时，需要注意如何才能有效地分割广播域。

   

   VLAN是广播域。而通常两个广播域之间由路由器连接，广播域之间来往的数据包都是由路由器中继的。因此，VLAN间的通信也需要路由器提供中继服务，这被称作“VLAN间路由”。

   ## VLAN间路由的端口类型：

   VLAN间路由，可以使用普通的路由器，也可以使用三层交换机。
   交换机的端口类型:

   ​	**访问链接(Access Link)**

   ​	**汇聚链接(Trunk Link)**：能够转发多个不同VLAN的通信的端口。

   

   **静态VLAN**基于端口:*明确指定各端口属于哪个VLAN的设定方法。*

   **动态VLAN**可以大致分为3类：
   	**基于MAC地址**:*假定有一个MAC地址“A”被交换机设定为属于VLAN “10”，那么不论MAC地址为“A”的这台计算机连在交换机哪个端口，该端口都会被划分到VLAN 10中去。计算机连在端口1时，端口1属于VLAN 10;而计算机连在端口2时，则是端口2属于VLAN 10。假定有一个MAC地址“A”被交换机设定为属于VLAN “10”，那么不论MAC地址为“A”的这台计算机连在交换机哪个端口，该端口都会被划分到VLAN 10中去。计算机连在端口1时，端口1属于VLAN 10;而计算机连在端口2时，则是端口2属于VLAN 10。*

   **基于子网**:*通过所连计算机的IP地址，来决定端口所属VLAN的。只要它的IP地址不变，就仍可以加入原先设定的VLAN。*

   **基于用户**：*根据交换机各端口所连的计算机上当前登录的用户，来决定该端口属于哪个VLAN。这里的用户识别信息，一般是计算机操作系统登录的用户，比如可以是Windows域中使用的用户名。这些用户名信息，属于OSI第四层以上的信息。*

## VLAN的汇聚方式

1. **IEEE 802.1Q**：俗称“**Dot One Q**”，是经过IEEE认证的对数据帧附加VLAN识别信息的协议。附加的VLAN识别信息，位于数据帧中“发送源MAC地址”与“类别域”(Type Field)之间。具体内容为2字节的TPID(Tag Protocol IDentifier)和2字节的TCI(Tag Control Information)，共计4字节。基于IEEE 802.1Q附加的VLAN信息，就像在传递物品时附加的标签。因此，它也被称作**“标签型VLAN”(Tagging VLAN)**。
2. **ISL**：是Cisco产品支持的一种与IEEE 802.1Q类似的、用于在汇聚链路上附加VLAN信息的协议。ISL用ISL包头和新CRC将原数据帧整个包裹起来，因此也被称为**“封装型VLAN”(Encapsulated VLAN)**。由于ISL是Cisco独有的协议，因此**只能用于Cisco网络设备之间的互联**。

## 为什么不同VLAN间不使用路由就无法通信？

在LAN内的通信，必须在**数据帧头中指定通信目标的MAC地址**。而为了**获取MAC地址，TCP/IP协议下使用的是ARP。ARP解析MAC地址的方法，则是通过广播**。也就是说，如果广播报文无法到达，那么就无从解析MAC地址，亦即无法直接通信。

## 路由器的作用：

1. **用于与WAN连接**。在大多数情况下，连接WAN还是需要用到路由器。
2. **使用路由器所提供的各种网络安全功能，用户可以构建更为安全可靠的网络**。除了最基本的数据包过滤功能外，还能基于IPSec构建VPN(VirtualPrivate Network)、利用RADIUS进行用户认证等。
3. **支持除TCP/IP以外的异构网络架构**。尽管TCP/IP已经成为当前网络协议架构的主流，但还有不少网络利用Novell Netware下的IPX/SPX或Macintosh下的AppleTalk等网络协议。三层交换机中，除了部分高端机型外基本上还只支持TCP/IP。因此，在需要使用除TCP/IP之外其他网络协议的环境下，路由器还是必不可少的。

